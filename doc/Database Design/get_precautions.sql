use team059;
-- drop procedure get_precautions;

delimiter //
create procedure get_precautions(in symptom_name varchar(50), in p_explain tinyint unsigned)
begin
	if (p_explain) then
		explain analyze 
        with disease_list as (
        select disease as name from Symptoms group by disease having case when symptom_name = 'itching' then avg(itching) >= 0.5 when symptom_name = 'skin_rash' then avg(skin_rash) >= 0.5 when symptom_name = 'nodal_skin_eruptions' then avg(nodal_skin_eruptions) >= 0.5 when symptom_name = 'continuous_sneezing' then avg(continuous_sneezing) >= 0.5 when symptom_name = 'shivering' then avg(shivering) >= 0.5 when symptom_name = 'chills' then avg(chills) >= 0.5 when symptom_name = 'joint_pain' then avg(joint_pain) >= 0.5 when symptom_name = 'stomach_pain' then avg(stomach_pain) >= 0.5 when symptom_name = 'acidity' then avg(acidity) >= 0.5 when symptom_name = 'ulcers_on_tongue' then avg(ulcers_on_tongue) >= 0.5 when symptom_name = 'muscle_wasting' then avg(muscle_wasting) >= 0.5 when symptom_name = 'vomiting' then avg(vomiting) >= 0.5 when symptom_name = 'burning_micturition' then avg(burning_micturition) >= 0.5 when symptom_name = 'spotting_urination' then avg(spotting_urination) >= 0.5 when symptom_name = 'fatigue' then avg(fatigue) >= 0.5 when symptom_name = 'weight_gain' then avg(weight_gain) >= 0.5 when symptom_name = 'anxiety' then avg(anxiety) >= 0.5 when symptom_name = 'cold_hands_and_feets' then avg(cold_hands_and_feets) >= 0.5 when symptom_name = 'mood_swings' then avg(mood_swings) >= 0.5 when symptom_name = 'weight_loss' then avg(weight_loss) >= 0.5 when symptom_name = 'restlessness' then avg(restlessness) >= 0.5 when symptom_name = 'lethargy' then avg(lethargy) >= 0.5 when symptom_name = 'patches_in_throat' then avg(patches_in_throat) >= 0.5 when symptom_name = 'irregular_sugar_level' then avg(irregular_sugar_level) >= 0.5 when symptom_name = 'cough' then avg(cough) >= 0.5 when symptom_name = 'high_fever' then avg(high_fever) >= 0.5 when symptom_name = 'sunken_eyes' then avg(sunken_eyes) >= 0.5 when symptom_name = 'breathlessness' then avg(breathlessness) >= 0.5 when symptom_name = 'sweating' then avg(sweating) >= 0.5 when symptom_name = 'dehydration' then avg(dehydration) >= 0.5 when symptom_name = 'indigestion' then avg(indigestion) >= 0.5 when symptom_name = 'headache' then avg(headache) >= 0.5 when symptom_name = 'yellowish_skin' then avg(yellowish_skin) >= 0.5 when symptom_name = 'dark_urine' then avg(dark_urine) >= 0.5 when symptom_name = 'nausea' then avg(nausea) >= 0.5 when symptom_name = 'loss_of_appetite' then avg(loss_of_appetite) >= 0.5 when symptom_name = 'pain_behind_the_eyes' then avg(pain_behind_the_eyes) >= 0.5 when symptom_name = 'back_pain' then avg(back_pain) >= 0.5 when symptom_name = 'constipation' then avg(constipation) >= 0.5 when symptom_name = 'abdominal_pain' then avg(abdominal_pain) >= 0.5 when symptom_name = 'diarrhoea' then avg(diarrhoea) >= 0.5 when symptom_name = 'mild_fever' then avg(mild_fever) >= 0.5 when symptom_name = 'yellow_urine' then avg(yellow_urine) >= 0.5 when symptom_name = 'yellowing_of_eyes' then avg(yellowing_of_eyes) >= 0.5 when symptom_name = 'acute_liver_failure' then avg(acute_liver_failure) >= 0.5 when symptom_name = 'fluid_overload' then avg(fluid_overload) >= 0.5 when symptom_name = 'swelling_of_stomach' then avg(swelling_of_stomach) >= 0.5 when symptom_name = 'swelled_lymph_nodes' then avg(swelled_lymph_nodes) >= 0.5 when symptom_name = 'malaise' then avg(malaise) >= 0.5 when symptom_name = 'blurred_and_distorted_vision' then avg(blurred_and_distorted_vision) >= 0.5 when symptom_name = 'phlegm' then avg(phlegm) >= 0.5 when symptom_name = 'throat_irritation' then avg(throat_irritation) >= 0.5 when symptom_name = 'redness_of_eyes' then avg(redness_of_eyes) >= 0.5 when symptom_name = 'sinus_pressure' then avg(sinus_pressure) >= 0.5 when symptom_name = 'runny_nose' then avg(runny_nose) >= 0.5 when symptom_name = 'congestion' then avg(congestion) >= 0.5 when symptom_name = 'chest_pain' then avg(chest_pain) >= 0.5 when symptom_name = 'weakness_in_limbs' then avg(weakness_in_limbs) >= 0.5 when symptom_name = 'fast_heart_rate' then avg(fast_heart_rate) >= 0.5 when symptom_name = 'pain_during_bowel_movements' then avg(pain_during_bowel_movements) >= 0.5 when symptom_name = 'pain_in_anal_region' then avg(pain_in_anal_region) >= 0.5 when symptom_name = 'bloody_stool' then avg(bloody_stool) >= 0.5 when symptom_name = 'irritation_in_anus' then avg(irritation_in_anus) >= 0.5 when symptom_name = 'neck_pain' then avg(neck_pain) >= 0.5 when symptom_name = 'dizziness' then avg(dizziness) >= 0.5 when symptom_name = 'cramps' then avg(cramps) >= 0.5 when symptom_name = 'bruising' then avg(bruising) >= 0.5 when symptom_name = 'obesity' then avg(obesity) >= 0.5 when symptom_name = 'swollen_legs' then avg(swollen_legs) >= 0.5 when symptom_name = 'swollen_blood_vessels' then avg(swollen_blood_vessels) >= 0.5 when symptom_name = 'puffy_face_and_eyes' then avg(puffy_face_and_eyes) >= 0.5 when symptom_name = 'enlarged_thyroid' then avg(enlarged_thyroid) >= 0.5 when symptom_name = 'brittle_nails' then avg(brittle_nails) >= 0.5 when symptom_name = 'swollen_extremeties' then avg(swollen_extremeties) >= 0.5 when symptom_name = 'excessive_hunger' then avg(excessive_hunger) >= 0.5 when symptom_name = 'extra_marital_contacts' then avg(extra_marital_contacts) >= 0.5 when symptom_name = 'drying_and_tingling_lips' then avg(drying_and_tingling_lips) >= 0.5 when symptom_name = 'slurred_speech' then avg(slurred_speech) >= 0.5 when symptom_name = 'knee_pain' then avg(knee_pain) >= 0.5 when symptom_name = 'hip_joint_pain' then avg(hip_joint_pain) >= 0.5 when symptom_name = 'muscle_weakness' then avg(muscle_weakness) >= 0.5 when symptom_name = 'stiff_neck' then avg(stiff_neck) >= 0.5 when symptom_name = 'swelling_joints' then avg(swelling_joints) >= 0.5 when symptom_name = 'movement_stiffness' then avg(movement_stiffness) >= 0.5 when symptom_name = 'spinning_movements' then avg(spinning_movements) >= 0.5 when symptom_name = 'loss_of_balance' then avg(loss_of_balance) >= 0.5 when symptom_name = 'unsteadiness' then avg(unsteadiness) >= 0.5 when symptom_name = 'weakness_of_one_body_side' then avg(weakness_of_one_body_side) >= 0.5 when symptom_name = 'loss_of_smell' then avg(loss_of_smell) >= 0.5 when symptom_name = 'bladder_discomfort' then avg(bladder_discomfort) >= 0.5 when symptom_name = 'foul_smell_of_urine' then avg(foul_smell_of_urine) >= 0.5 when symptom_name = 'continuous_feel_of_urine' then avg(continuous_feel_of_urine) >= 0.5 when symptom_name = 'passage_of_gases' then avg(passage_of_gases) >= 0.5 when symptom_name = 'internal_itching' then avg(internal_itching) >= 0.5 when symptom_name = 'toxic_look_typhos' then avg(toxic_look_typhos) >= 0.5 when symptom_name = 'depression' then avg(depression) >= 0.5 when symptom_name = 'irritability' then avg(irritability) >= 0.5 when symptom_name = 'muscle_pain' then avg(muscle_pain) >= 0.5 when symptom_name = 'altered_sensorium' then avg(altered_sensorium) >= 0.5 when symptom_name = 'red_spots_over_body' then avg(red_spots_over_body) >= 0.5 when symptom_name = 'belly_pain' then avg(belly_pain) >= 0.5 when symptom_name = 'abnormal_menstruation' then avg(abnormal_menstruation) >= 0.5 when symptom_name = 'dischromic_patches' then avg(dischromic_patches) >= 0.5 when symptom_name = 'watering_from_eyes' then avg(watering_from_eyes) >= 0.5 when symptom_name = 'increased_appetite' then avg(increased_appetite) >= 0.5 when symptom_name = 'polyuria' then avg(polyuria) >= 0.5 when symptom_name = 'family_history' then avg(family_history) >= 0.5 when symptom_name = 'mucoid_sputum' then avg(mucoid_sputum) >= 0.5 when symptom_name = 'rusty_sputum' then avg(rusty_sputum) >= 0.5 when symptom_name = 'lack_of_concentration' then avg(lack_of_concentration) >= 0.5 when symptom_name = 'visual_disturbances' then avg(visual_disturbances) >= 0.5 when symptom_name = 'receiving_blood_transfusion' then avg(receiving_blood_transfusion) >= 0.5 when symptom_name = 'receiving_unsterile_injections' then avg(receiving_unsterile_injections) >= 0.5 when symptom_name = 'coma' then avg(coma) >= 0.5 when symptom_name = 'stomach_bleeding' then avg(stomach_bleeding) >= 0.5 when symptom_name = 'distention_of_abdomen' then avg(distention_of_abdomen) >= 0.5 when symptom_name = 'history_of_alcohol_consumption' then avg(history_of_alcohol_consumption) >= 0.5 when symptom_name = 'blood_in_sputum' then avg(blood_in_sputum) >= 0.5 when symptom_name = 'prominent_veins_on_calf' then avg(prominent_veins_on_calf) >= 0.5 when symptom_name = 'palpitations' then avg(palpitations) >= 0.5 when symptom_name = 'painful_walking' then avg(painful_walking) >= 0.5 when symptom_name = 'pus_filled_pimples' then avg(pus_filled_pimples) >= 0.5 when symptom_name = 'blackheads' then avg(blackheads) >= 0.5 when symptom_name = 'scurring' then avg(scurring) >= 0.5 when symptom_name = 'skin_peeling' then avg(skin_peeling) >= 0.5 when symptom_name = 'silver_like_dusting' then avg(silver_like_dusting) >= 0.5 when symptom_name = 'small_dents_in_nails' then avg(small_dents_in_nails) >= 0.5 when symptom_name = 'inflammatory_nails' then avg(inflammatory_nails) >= 0.5 when symptom_name = 'blister' then avg(blister) >= 0.5 when symptom_name = 'ed_sore_around_nose' then avg(ed_sore_around_nose) >= 0.5 when symptom_name = 'yellow_crust_ooze' then avg(yellow_crust_ooze) >= 0.5 end
        )
        select precaution, count(precaution)
		from (
			select precaution_1 as precaution from Diseases natural join disease_list
			union all
            select precaution_2 as precaution from Diseases natural join disease_list
            union all
            select precaution_3 as precaution from Diseases natural join disease_list
            union all
            select precaution_4 as precaution from Diseases natural join disease_list
		) as temp
		group by precaution
		order by count(precaution) desc, precaution;
	else
        with disease_list as (
        select disease as name from Symptoms group by disease having case when symptom_name = 'itching' then avg(itching) >= 0.5 when symptom_name = 'skin_rash' then avg(skin_rash) >= 0.5 when symptom_name = 'nodal_skin_eruptions' then avg(nodal_skin_eruptions) >= 0.5 when symptom_name = 'continuous_sneezing' then avg(continuous_sneezing) >= 0.5 when symptom_name = 'shivering' then avg(shivering) >= 0.5 when symptom_name = 'chills' then avg(chills) >= 0.5 when symptom_name = 'joint_pain' then avg(joint_pain) >= 0.5 when symptom_name = 'stomach_pain' then avg(stomach_pain) >= 0.5 when symptom_name = 'acidity' then avg(acidity) >= 0.5 when symptom_name = 'ulcers_on_tongue' then avg(ulcers_on_tongue) >= 0.5 when symptom_name = 'muscle_wasting' then avg(muscle_wasting) >= 0.5 when symptom_name = 'vomiting' then avg(vomiting) >= 0.5 when symptom_name = 'burning_micturition' then avg(burning_micturition) >= 0.5 when symptom_name = 'spotting_urination' then avg(spotting_urination) >= 0.5 when symptom_name = 'fatigue' then avg(fatigue) >= 0.5 when symptom_name = 'weight_gain' then avg(weight_gain) >= 0.5 when symptom_name = 'anxiety' then avg(anxiety) >= 0.5 when symptom_name = 'cold_hands_and_feets' then avg(cold_hands_and_feets) >= 0.5 when symptom_name = 'mood_swings' then avg(mood_swings) >= 0.5 when symptom_name = 'weight_loss' then avg(weight_loss) >= 0.5 when symptom_name = 'restlessness' then avg(restlessness) >= 0.5 when symptom_name = 'lethargy' then avg(lethargy) >= 0.5 when symptom_name = 'patches_in_throat' then avg(patches_in_throat) >= 0.5 when symptom_name = 'irregular_sugar_level' then avg(irregular_sugar_level) >= 0.5 when symptom_name = 'cough' then avg(cough) >= 0.5 when symptom_name = 'high_fever' then avg(high_fever) >= 0.5 when symptom_name = 'sunken_eyes' then avg(sunken_eyes) >= 0.5 when symptom_name = 'breathlessness' then avg(breathlessness) >= 0.5 when symptom_name = 'sweating' then avg(sweating) >= 0.5 when symptom_name = 'dehydration' then avg(dehydration) >= 0.5 when symptom_name = 'indigestion' then avg(indigestion) >= 0.5 when symptom_name = 'headache' then avg(headache) >= 0.5 when symptom_name = 'yellowish_skin' then avg(yellowish_skin) >= 0.5 when symptom_name = 'dark_urine' then avg(dark_urine) >= 0.5 when symptom_name = 'nausea' then avg(nausea) >= 0.5 when symptom_name = 'loss_of_appetite' then avg(loss_of_appetite) >= 0.5 when symptom_name = 'pain_behind_the_eyes' then avg(pain_behind_the_eyes) >= 0.5 when symptom_name = 'back_pain' then avg(back_pain) >= 0.5 when symptom_name = 'constipation' then avg(constipation) >= 0.5 when symptom_name = 'abdominal_pain' then avg(abdominal_pain) >= 0.5 when symptom_name = 'diarrhoea' then avg(diarrhoea) >= 0.5 when symptom_name = 'mild_fever' then avg(mild_fever) >= 0.5 when symptom_name = 'yellow_urine' then avg(yellow_urine) >= 0.5 when symptom_name = 'yellowing_of_eyes' then avg(yellowing_of_eyes) >= 0.5 when symptom_name = 'acute_liver_failure' then avg(acute_liver_failure) >= 0.5 when symptom_name = 'fluid_overload' then avg(fluid_overload) >= 0.5 when symptom_name = 'swelling_of_stomach' then avg(swelling_of_stomach) >= 0.5 when symptom_name = 'swelled_lymph_nodes' then avg(swelled_lymph_nodes) >= 0.5 when symptom_name = 'malaise' then avg(malaise) >= 0.5 when symptom_name = 'blurred_and_distorted_vision' then avg(blurred_and_distorted_vision) >= 0.5 when symptom_name = 'phlegm' then avg(phlegm) >= 0.5 when symptom_name = 'throat_irritation' then avg(throat_irritation) >= 0.5 when symptom_name = 'redness_of_eyes' then avg(redness_of_eyes) >= 0.5 when symptom_name = 'sinus_pressure' then avg(sinus_pressure) >= 0.5 when symptom_name = 'runny_nose' then avg(runny_nose) >= 0.5 when symptom_name = 'congestion' then avg(congestion) >= 0.5 when symptom_name = 'chest_pain' then avg(chest_pain) >= 0.5 when symptom_name = 'weakness_in_limbs' then avg(weakness_in_limbs) >= 0.5 when symptom_name = 'fast_heart_rate' then avg(fast_heart_rate) >= 0.5 when symptom_name = 'pain_during_bowel_movements' then avg(pain_during_bowel_movements) >= 0.5 when symptom_name = 'pain_in_anal_region' then avg(pain_in_anal_region) >= 0.5 when symptom_name = 'bloody_stool' then avg(bloody_stool) >= 0.5 when symptom_name = 'irritation_in_anus' then avg(irritation_in_anus) >= 0.5 when symptom_name = 'neck_pain' then avg(neck_pain) >= 0.5 when symptom_name = 'dizziness' then avg(dizziness) >= 0.5 when symptom_name = 'cramps' then avg(cramps) >= 0.5 when symptom_name = 'bruising' then avg(bruising) >= 0.5 when symptom_name = 'obesity' then avg(obesity) >= 0.5 when symptom_name = 'swollen_legs' then avg(swollen_legs) >= 0.5 when symptom_name = 'swollen_blood_vessels' then avg(swollen_blood_vessels) >= 0.5 when symptom_name = 'puffy_face_and_eyes' then avg(puffy_face_and_eyes) >= 0.5 when symptom_name = 'enlarged_thyroid' then avg(enlarged_thyroid) >= 0.5 when symptom_name = 'brittle_nails' then avg(brittle_nails) >= 0.5 when symptom_name = 'swollen_extremeties' then avg(swollen_extremeties) >= 0.5 when symptom_name = 'excessive_hunger' then avg(excessive_hunger) >= 0.5 when symptom_name = 'extra_marital_contacts' then avg(extra_marital_contacts) >= 0.5 when symptom_name = 'drying_and_tingling_lips' then avg(drying_and_tingling_lips) >= 0.5 when symptom_name = 'slurred_speech' then avg(slurred_speech) >= 0.5 when symptom_name = 'knee_pain' then avg(knee_pain) >= 0.5 when symptom_name = 'hip_joint_pain' then avg(hip_joint_pain) >= 0.5 when symptom_name = 'muscle_weakness' then avg(muscle_weakness) >= 0.5 when symptom_name = 'stiff_neck' then avg(stiff_neck) >= 0.5 when symptom_name = 'swelling_joints' then avg(swelling_joints) >= 0.5 when symptom_name = 'movement_stiffness' then avg(movement_stiffness) >= 0.5 when symptom_name = 'spinning_movements' then avg(spinning_movements) >= 0.5 when symptom_name = 'loss_of_balance' then avg(loss_of_balance) >= 0.5 when symptom_name = 'unsteadiness' then avg(unsteadiness) >= 0.5 when symptom_name = 'weakness_of_one_body_side' then avg(weakness_of_one_body_side) >= 0.5 when symptom_name = 'loss_of_smell' then avg(loss_of_smell) >= 0.5 when symptom_name = 'bladder_discomfort' then avg(bladder_discomfort) >= 0.5 when symptom_name = 'foul_smell_of_urine' then avg(foul_smell_of_urine) >= 0.5 when symptom_name = 'continuous_feel_of_urine' then avg(continuous_feel_of_urine) >= 0.5 when symptom_name = 'passage_of_gases' then avg(passage_of_gases) >= 0.5 when symptom_name = 'internal_itching' then avg(internal_itching) >= 0.5 when symptom_name = 'toxic_look_typhos' then avg(toxic_look_typhos) >= 0.5 when symptom_name = 'depression' then avg(depression) >= 0.5 when symptom_name = 'irritability' then avg(irritability) >= 0.5 when symptom_name = 'muscle_pain' then avg(muscle_pain) >= 0.5 when symptom_name = 'altered_sensorium' then avg(altered_sensorium) >= 0.5 when symptom_name = 'red_spots_over_body' then avg(red_spots_over_body) >= 0.5 when symptom_name = 'belly_pain' then avg(belly_pain) >= 0.5 when symptom_name = 'abnormal_menstruation' then avg(abnormal_menstruation) >= 0.5 when symptom_name = 'dischromic_patches' then avg(dischromic_patches) >= 0.5 when symptom_name = 'watering_from_eyes' then avg(watering_from_eyes) >= 0.5 when symptom_name = 'increased_appetite' then avg(increased_appetite) >= 0.5 when symptom_name = 'polyuria' then avg(polyuria) >= 0.5 when symptom_name = 'family_history' then avg(family_history) >= 0.5 when symptom_name = 'mucoid_sputum' then avg(mucoid_sputum) >= 0.5 when symptom_name = 'rusty_sputum' then avg(rusty_sputum) >= 0.5 when symptom_name = 'lack_of_concentration' then avg(lack_of_concentration) >= 0.5 when symptom_name = 'visual_disturbances' then avg(visual_disturbances) >= 0.5 when symptom_name = 'receiving_blood_transfusion' then avg(receiving_blood_transfusion) >= 0.5 when symptom_name = 'receiving_unsterile_injections' then avg(receiving_unsterile_injections) >= 0.5 when symptom_name = 'coma' then avg(coma) >= 0.5 when symptom_name = 'stomach_bleeding' then avg(stomach_bleeding) >= 0.5 when symptom_name = 'distention_of_abdomen' then avg(distention_of_abdomen) >= 0.5 when symptom_name = 'history_of_alcohol_consumption' then avg(history_of_alcohol_consumption) >= 0.5 when symptom_name = 'blood_in_sputum' then avg(blood_in_sputum) >= 0.5 when symptom_name = 'prominent_veins_on_calf' then avg(prominent_veins_on_calf) >= 0.5 when symptom_name = 'palpitations' then avg(palpitations) >= 0.5 when symptom_name = 'painful_walking' then avg(painful_walking) >= 0.5 when symptom_name = 'pus_filled_pimples' then avg(pus_filled_pimples) >= 0.5 when symptom_name = 'blackheads' then avg(blackheads) >= 0.5 when symptom_name = 'scurring' then avg(scurring) >= 0.5 when symptom_name = 'skin_peeling' then avg(skin_peeling) >= 0.5 when symptom_name = 'silver_like_dusting' then avg(silver_like_dusting) >= 0.5 when symptom_name = 'small_dents_in_nails' then avg(small_dents_in_nails) >= 0.5 when symptom_name = 'inflammatory_nails' then avg(inflammatory_nails) >= 0.5 when symptom_name = 'blister' then avg(blister) >= 0.5 when symptom_name = 'ed_sore_around_nose' then avg(ed_sore_around_nose) >= 0.5 when symptom_name = 'yellow_crust_ooze' then avg(yellow_crust_ooze) >= 0.5 end
        )
        select precaution, count(precaution)
		from (
			select precaution_1 as precaution from Diseases natural join disease_list
			union all
            select precaution_2 as precaution from Diseases natural join disease_list
            union all
            select precaution_3 as precaution from Diseases natural join disease_list
            union all
            select precaution_4 as precaution from Diseases natural join disease_list
		) as temp
		group by precaution
		order by count(precaution) desc, precaution;
	end if;

end //
delimiter ;
	