use team059;

-- drop procedure get_symptom_ratio;

delimiter //
create procedure get_symptom_ratio(in suggested_disease varchar(50)) 
begin
	SELECT AVG(avg_ratio) AS average_ratio
	FROM (
		SELECT SUM(case WHEN s1.itching = 1 AND s2.itching = 1 THEN 1 WHEN s1.skin_rash = 1 AND s2.skin_rash = 1 THEN 1 WHEN s1.nodal_skin_eruptions = 1 AND s2.nodal_skin_eruptions = 1 THEN 1 WHEN s1.continuous_sneezing = 1 AND s2.continuous_sneezing = 1 THEN 1 WHEN s1.shivering = 1 AND s2.shivering = 1 THEN 1 WHEN s1.chills = 1 AND s2.chills = 1 THEN 1 WHEN s1.joint_pain = 1 AND s2.joint_pain = 1 THEN 1 WHEN s1.stomach_pain = 1 AND s2.stomach_pain = 1 THEN 1 WHEN s1.acidity = 1 AND s2.acidity = 1 THEN 1 WHEN s1.ulcers_on_tongue = 1 AND s2.ulcers_on_tongue = 1 THEN 1 WHEN s1.muscle_wasting = 1 AND s2.muscle_wasting = 1 THEN 1 WHEN s1.vomiting = 1 AND s2.vomiting = 1 THEN 1 WHEN s1.burning_micturition = 1 AND s2.burning_micturition = 1 THEN 1 WHEN s1.spotting_urination = 1 AND s2.spotting_urination = 1 THEN 1 WHEN s1.fatigue = 1 AND s2.fatigue = 1 THEN 1 WHEN s1.weight_gain = 1 AND s2.weight_gain = 1 THEN 1 WHEN s1.anxiety = 1 AND s2.anxiety = 1 THEN 1 WHEN s1.cold_hands_and_feets = 1 AND s2.cold_hands_and_feets = 1 THEN 1 WHEN s1.mood_swings = 1 AND s2.mood_swings = 1 THEN 1 WHEN s1.weight_loss = 1 AND s2.weight_loss = 1 THEN 1 WHEN s1.restlessness = 1 AND s2.restlessness = 1 THEN 1 WHEN s1.lethargy = 1 AND s2.lethargy = 1 THEN 1 WHEN s1.patches_in_throat = 1 AND s2.patches_in_throat = 1 THEN 1 WHEN s1.irregular_sugar_level = 1 AND s2.irregular_sugar_level = 1 THEN 1 WHEN s1.cough = 1 AND s2.cough = 1 THEN 1 WHEN s1.high_fever = 1 AND s2.high_fever = 1 THEN 1 WHEN s1.sunken_eyes = 1 AND s2.sunken_eyes = 1 THEN 1 WHEN s1.breathlessness = 1 AND s2.breathlessness = 1 THEN 1 WHEN s1.sweating = 1 AND s2.sweating = 1 THEN 1 WHEN s1.dehydration = 1 AND s2.dehydration = 1 THEN 1 WHEN s1.indigestion = 1 AND s2.indigestion = 1 THEN 1 WHEN s1.headache = 1 AND s2.headache = 1 THEN 1 WHEN s1.yellowish_skin = 1 AND s2.yellowish_skin = 1 THEN 1 WHEN s1.dark_urine = 1 AND s2.dark_urine = 1 THEN 1 WHEN s1.nausea = 1 AND s2.nausea = 1 THEN 1 WHEN s1.loss_of_appetite = 1 AND s2.loss_of_appetite = 1 THEN 1 WHEN s1.pain_behind_the_eyes = 1 AND s2.pain_behind_the_eyes = 1 THEN 1 WHEN s1.back_pain = 1 AND s2.back_pain = 1 THEN 1 WHEN s1.constipation = 1 AND s2.constipation = 1 THEN 1 WHEN s1.abdominal_pain = 1 AND s2.abdominal_pain = 1 THEN 1 WHEN s1.diarrhoea = 1 AND s2.diarrhoea = 1 THEN 1 WHEN s1.mild_fever = 1 AND s2.mild_fever = 1 THEN 1 WHEN s1.yellow_urine = 1 AND s2.yellow_urine = 1 THEN 1 WHEN s1.yellowing_of_eyes = 1 AND s2.yellowing_of_eyes = 1 THEN 1 WHEN s1.acute_liver_failure = 1 AND s2.acute_liver_failure = 1 THEN 1 WHEN s1.fluid_overload = 1 AND s2.fluid_overload = 1 THEN 1 WHEN s1.swelling_of_stomach = 1 AND s2.swelling_of_stomach = 1 THEN 1 WHEN s1.swelled_lymph_nodes = 1 AND s2.swelled_lymph_nodes = 1 THEN 1 WHEN s1.malaise = 1 AND s2.malaise = 1 THEN 1 WHEN s1.blurred_and_distorted_vision = 1 AND s2.blurred_and_distorted_vision = 1 THEN 1 WHEN s1.phlegm = 1 AND s2.phlegm = 1 THEN 1 WHEN s1.throat_irritation = 1 AND s2.throat_irritation = 1 THEN 1 WHEN s1.redness_of_eyes = 1 AND s2.redness_of_eyes = 1 THEN 1 WHEN s1.sinus_pressure = 1 AND s2.sinus_pressure = 1 THEN 1 WHEN s1.runny_nose = 1 AND s2.runny_nose = 1 THEN 1 WHEN s1.congestion = 1 AND s2.congestion = 1 THEN 1 WHEN s1.chest_pain = 1 AND s2.chest_pain = 1 THEN 1 WHEN s1.weakness_in_limbs = 1 AND s2.weakness_in_limbs = 1 THEN 1 WHEN s1.fast_heart_rate = 1 AND s2.fast_heart_rate = 1 THEN 1 WHEN s1.pain_during_bowel_movements = 1 AND s2.pain_during_bowel_movements = 1 THEN 1 WHEN s1.pain_in_anal_region = 1 AND s2.pain_in_anal_region = 1 THEN 1 WHEN s1.bloody_stool = 1 AND s2.bloody_stool = 1 THEN 1 WHEN s1.irritation_in_anus = 1 AND s2.irritation_in_anus = 1 THEN 1 WHEN s1.neck_pain = 1 AND s2.neck_pain = 1 THEN 1 WHEN s1.dizziness = 1 AND s2.dizziness = 1 THEN 1 WHEN s1.cramps = 1 AND s2.cramps = 1 THEN 1 WHEN s1.bruising = 1 AND s2.bruising = 1 THEN 1 WHEN s1.obesity = 1 AND s2.obesity = 1 THEN 1 WHEN s1.swollen_legs = 1 AND s2.swollen_legs = 1 THEN 1 WHEN s1.swollen_blood_vessels = 1 AND s2.swollen_blood_vessels = 1 THEN 1 WHEN s1.puffy_face_and_eyes = 1 AND s2.puffy_face_and_eyes = 1 THEN 1 WHEN s1.enlarged_thyroid = 1 AND s2.enlarged_thyroid = 1 THEN 1 WHEN s1.brittle_nails = 1 AND s2.brittle_nails = 1 THEN 1 WHEN s1.swollen_extremeties = 1 AND s2.swollen_extremeties = 1 THEN 1 WHEN s1.excessive_hunger = 1 AND s2.excessive_hunger = 1 THEN 1 WHEN s1.extra_marital_contacts = 1 AND s2.extra_marital_contacts = 1 THEN 1 WHEN s1.drying_and_tingling_lips = 1 AND s2.drying_and_tingling_lips = 1 THEN 1 WHEN s1.slurred_speech = 1 AND s2.slurred_speech = 1 THEN 1 WHEN s1.knee_pain = 1 AND s2.knee_pain = 1 THEN 1 WHEN s1.hip_joint_pain = 1 AND s2.hip_joint_pain = 1 THEN 1 WHEN s1.muscle_weakness = 1 AND s2.muscle_weakness = 1 THEN 1 WHEN s1.stiff_neck = 1 AND s2.stiff_neck = 1 THEN 1 WHEN s1.swelling_joints = 1 AND s2.swelling_joints = 1 THEN 1 WHEN s1.movement_stiffness = 1 AND s2.movement_stiffness = 1 THEN 1 WHEN s1.spinning_movements = 1 AND s2.spinning_movements = 1 THEN 1 WHEN s1.loss_of_balance = 1 AND s2.loss_of_balance = 1 THEN 1 WHEN s1.unsteadiness = 1 AND s2.unsteadiness = 1 THEN 1 WHEN s1.weakness_of_one_body_side = 1 AND s2.weakness_of_one_body_side = 1 THEN 1 WHEN s1.loss_of_smell = 1 AND s2.loss_of_smell = 1 THEN 1 WHEN s1.bladder_discomfort = 1 AND s2.bladder_discomfort = 1 THEN 1 WHEN s1.foul_smell_of_urine = 1 AND s2.foul_smell_of_urine = 1 THEN 1 WHEN s1.continuous_feel_of_urine = 1 AND s2.continuous_feel_of_urine = 1 THEN 1 WHEN s1.passage_of_gases = 1 AND s2.passage_of_gases = 1 THEN 1 WHEN s1.internal_itching = 1 AND s2.internal_itching = 1 THEN 1 WHEN s1.toxic_look_typhos = 1 AND s2.toxic_look_typhos = 1 THEN 1 WHEN s1.depression = 1 AND s2.depression = 1 THEN 1 WHEN s1.irritability = 1 AND s2.irritability = 1 THEN 1 WHEN s1.muscle_pain = 1 AND s2.muscle_pain = 1 THEN 1 WHEN s1.altered_sensorium = 1 AND s2.altered_sensorium = 1 THEN 1 WHEN s1.red_spots_over_body = 1 AND s2.red_spots_over_body = 1 THEN 1 WHEN s1.belly_pain = 1 AND s2.belly_pain = 1 THEN 1 WHEN s1.abnormal_menstruation = 1 AND s2.abnormal_menstruation = 1 THEN 1 WHEN s1.dischromic_patches = 1 AND s2.dischromic_patches = 1 THEN 1 WHEN s1.watering_from_eyes = 1 AND s2.watering_from_eyes = 1 THEN 1 WHEN s1.increased_appetite = 1 AND s2.increased_appetite = 1 THEN 1 WHEN s1.polyuria = 1 AND s2.polyuria = 1 THEN 1 WHEN s1.family_history = 1 AND s2.family_history = 1 THEN 1 WHEN s1.mucoid_sputum = 1 AND s2.mucoid_sputum = 1 THEN 1 WHEN s1.rusty_sputum = 1 AND s2.rusty_sputum = 1 THEN 1 WHEN s1.lack_of_concentration = 1 AND s2.lack_of_concentration = 1 THEN 1 WHEN s1.visual_disturbances = 1 AND s2.visual_disturbances = 1 THEN 1 WHEN s1.receiving_blood_transfusion = 1 AND s2.receiving_blood_transfusion = 1 THEN 1 WHEN s1.receiving_unsterile_injections = 1 AND s2.receiving_unsterile_injections = 1 THEN 1 WHEN s1.coma = 1 AND s2.coma = 1 THEN 1 WHEN s1.stomach_bleeding = 1 AND s2.stomach_bleeding = 1 THEN 1 WHEN s1.distention_of_abdomen = 1 AND s2.distention_of_abdomen = 1 THEN 1 WHEN s1.history_of_alcohol_consumption = 1 AND s2.history_of_alcohol_consumption = 1 THEN 1 WHEN s1.blood_in_sputum = 1 AND s2.blood_in_sputum = 1 THEN 1 WHEN s1.prominent_veins_on_calf = 1 AND s2.prominent_veins_on_calf = 1 THEN 1 WHEN s1.palpitations = 1 AND s2.palpitations = 1 THEN 1 WHEN s1.painful_walking = 1 AND s2.painful_walking = 1 THEN 1 WHEN s1.pus_filled_pimples = 1 AND s2.pus_filled_pimples = 1 THEN 1 WHEN s1.blackheads = 1 AND s2.blackheads = 1 THEN 1 WHEN s1.scurring = 1 AND s2.scurring = 1 THEN 1 WHEN s1.skin_peeling = 1 AND s2.skin_peeling = 1 THEN 1 WHEN s1.silver_like_dusting = 1 AND s2.silver_like_dusting = 1 THEN 1 WHEN s1.small_dents_in_nails = 1 AND s2.small_dents_in_nails = 1 THEN 1 WHEN s1.inflammatory_nails = 1 AND s2.inflammatory_nails = 1 THEN 1 WHEN s1.blister = 1 AND s2.blister = 1 THEN 1 WHEN s1.ed_sore_around_nose = 1 AND s2.ed_sore_around_nose = 1 THEN 1 WHEN s1.yellow_crust_ooze = 1 AND s2.yellow_crust_ooze = 1 THEN 1 ELSE 0 END) / COUNT(*) AS avg_ratio
		FROM (
			SELECT caseitching, skin_rash, nodal_skin_eruptions, continuous_sneezing, shivering, chills, joint_pain, stomach_pain, acidity, ulcers_on_tongue, muscle_wasting, vomiting, burning_micturition, spotting_urination, fatigue, weight_gain, anxiety, cold_hands_and_feets, mood_swings, weight_loss, restlessness, lethargy, patches_in_throat, irregular_sugar_level, cough, high_fever, sunken_eyes, breathlessness, sweating, dehydration, indigestion, headache, yellowish_skin, dark_urine, nausea, loss_of_appetite, pain_behind_the_eyes, back_pain, constipation, abdominal_pain, diarrhoea, mild_fever, yellow_urine, yellowing_of_eyes, acute_liver_failure, fluid_overload, swelling_of_stomach, swelled_lymph_nodes, malaise, blurred_and_distorted_vision, phlegm, throat_irritation, redness_of_eyes, sinus_pressure, runny_nose, congestion, chest_pain, weakness_in_limbs, fast_heart_rate, pain_during_bowel_movements, pain_in_anal_region, bloody_stool, irritation_in_anus, neck_pain, dizziness, cramps, bruising, obesity, swollen_legs, swollen_blood_vessels, puffy_face_and_eyes, enlarged_thyroid, brittle_nails, swollen_extremeties, excessive_hunger, extra_marital_contacts, drying_and_tingling_lips, slurred_speech, knee_pain, hip_joint_pain, muscle_weakness, stiff_neck, swelling_joints, movement_stiffness, spinning_movements, loss_of_balance, unsteadiness, weakness_of_one_body_side, loss_of_smell, bladder_discomfort, foul_smell_of_urine, continuous_feel_of_urine, passage_of_gases, internal_itching, toxic_look_typhos, depression, irritability, muscle_pain, altered_sensorium, red_spots_over_body, belly_pain, abnormal_menstruation, dischromic_patches, watering_from_eyes, increased_appetite, polyuria, family_history, mucoid_sputum, rusty_sputum, lack_of_concentration, visual_disturbances, receiving_blood_transfusion, receiving_unsterile_injections, coma, stomach_bleeding, distention_of_abdomen, history_of_alcohol_consumption, blood_in_sputum, prominent_veins_on_calf, palpitations, painful_walking, pus_filled_pimples, blackheads, scurring, skin_peeling, silver_like_dusting, small_dents_in_nails, inflammatory_nails, blister, ed_sore_around_nose, yellow_crust_ooze
			FROM symptoms
			WHERE disease_name = suggested_disease
		) AS s1
		CROSS JOIN (
			SELECT caseitching, skin_rash, nodal_skin_eruptions, continuous_sneezing, shivering, chills, joint_pain, stomach_pain, acidity, ulcers_on_tongue, muscle_wasting, vomiting, burning_micturition, spotting_urination, fatigue, weight_gain, anxiety, cold_hands_and_feets, mood_swings, weight_loss, restlessness, lethargy, patches_in_throat, irregular_sugar_level, cough, high_fever, sunken_eyes, breathlessness, sweating, dehydration, indigestion, headache, yellowish_skin, dark_urine, nausea, loss_of_appetite, pain_behind_the_eyes, back_pain, constipation, abdominal_pain, diarrhoea, mild_fever, yellow_urine, yellowing_of_eyes, acute_liver_failure, fluid_overload, swelling_of_stomach, swelled_lymph_nodes, malaise, blurred_and_distorted_vision, phlegm, throat_irritation, redness_of_eyes, sinus_pressure, runny_nose, congestion, chest_pain, weakness_in_limbs, fast_heart_rate, pain_during_bowel_movements, pain_in_anal_region, bloody_stool, irritation_in_anus, neck_pain, dizziness, cramps, bruising, obesity, swollen_legs, swollen_blood_vessels, puffy_face_and_eyes, enlarged_thyroid, brittle_nails, swollen_extremeties, excessive_hunger, extra_marital_contacts, drying_and_tingling_lips, slurred_speech, knee_pain, hip_joint_pain, muscle_weakness, stiff_neck, swelling_joints, movement_stiffness, spinning_movements, loss_of_balance, unsteadiness, weakness_of_one_body_side, loss_of_smell, bladder_discomfort, foul_smell_of_urine, continuous_feel_of_urine, passage_of_gases, internal_itching, toxic_look_typhos, depression, irritability, muscle_pain, altered_sensorium, red_spots_over_body, belly_pain, abnormal_menstruation, dischromic_patches, watering_from_eyes, increased_appetite, polyuria, family_history, mucoid_sputum, rusty_sputum, lack_of_concentration, visual_disturbances, receiving_blood_transfusion, receiving_unsterile_injections, coma, stomach_bleeding, distention_of_abdomen, history_of_alcohol_consumption, blood_in_sputum, prominent_veins_on_calf, palpitations, painful_walking, pus_filled_pimples, blackheads, scurring, skin_peeling, silver_like_dusting, small_dents_in_nails, inflammatory_nails, blister, ed_sore_around_nose, yellow_crust_ooze
			FROM symptoms
		) AS s2
	);
end
delimiter ;